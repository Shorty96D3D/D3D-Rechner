<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>D3D Kalk-Manager</title>
<style>
body { font-family: -apple-system, sans-serif; padding: 10px; background: #121212; color: #e0e0e0; line-height: 1.4; }
.card { background: #1e1e1e; padding: 15px; border-radius: 12px; max-width: 600px; margin: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.6); }
h2 { color: #007bff; text-align: center; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
.section { background: #252525; padding: 12px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #333; }
h3 { font-size: 14px; margin: 0 0 10px 0; color: #00d4ff; border-bottom: 1px solid #444; padding-bottom: 5px; }
label { display: block; margin-top: 8px; font-size: 11px; color: #888; text-transform: uppercase; }
input, select { width: 100%; padding: 10px; margin-top: 4px; border: 1px solid #444; border-radius: 6px; background: #121212; color: white; font-size: 15px; box-sizing: border-box; }
.grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
button { width: 100%; padding: 14px; border: none; border-radius: 6px; font-size: 16px; font-weight: bold; margin-top: 10px; cursor: pointer; transition: 0.2s; }
.btn-calc { background: #6c757d; color: white; } /* Grau f√ºr reines Rechnen */
.btn-order { background: #28a745; color: white; } /* Gr√ºn f√ºr Abbuchen */
.btn-add { background: #007bff; font-size: 13px; padding: 8px; }
.inventory-item { background: #2a2a2a; padding: 10px; border-radius: 6px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; font-size: 13px; border-left: 3px solid #00d4ff; }
.low-stock { border-left: 5px solid #ff4444 !important; }
.low-stock-text { color: #ff4444; font-weight: bold; }
.delete-btn { color: #ff4444; font-weight: bold; background: none; border: none; padding: 5px 15px; cursor: pointer; }
.total-box { margin-top: 15px; padding: 15px; background: #121212; border-radius: 8px; text-align: center; border: 1px solid #00d4ff; }
.price-tag { font-size: 26px; color: #00d4ff; font-weight: bold; display: block; }
.success-msg { color: #28a745; font-size: 12px; margin-top: 5px; font-weight: bold; display: none; }
</style>
</head>
<body>
<div class="card">
<h2>D3D Business Manager</h2>

<div class="section">
<h3>üì¶ Lagerbestand & Warenwert</h3>
<div id="inventory-list"></div>
<div id="warehouse-value" style="font-size: 12px; color: #28a745; margin-top: 10px; text-align: right;">Warenwert: 0,00 ‚Ç¨</div>

<hr style="border: 0; border-top: 1px solid #444; margin: 15px 0;">

<label>Neues Material Name:</label>
<input type="text" id="new_name" placeholder="z.B. PLA Schwarz">
<div class="grid">
<div>
<label>Preis (‚Ç¨/kg)</label>
<input type="number" id="new_price" step="0.01" placeholder="25.00">
</div>
<div>
<label>Bestand (g)</label>
<input type="number" id="new_stock" placeholder="1000">
</div>
</div>
<button class="btn-add" onclick="addMaterial()">+ Material hinzuf√ºgen</button>
</div>

<div class="section">
<h3>üöÄ Kalkulation</h3>
<label>Material ausw√§hlen:</label>
<select id="calc_mat_select"></select>

<div class="grid">
<div>
<label>Verbrauch (g)</label>
<input type="number" id="calc_g" placeholder="85">
</div>
<div>
<label>Druckzeit (h)</label>
<input type="number" id="calc_h" placeholder="4">
</div>
</div>

<div class="grid">
<div>
<label>Arbeit (min)</label>
<input type="number" id="calc_min" placeholder="15">
</div>
<div>
<label>Lohn (‚Ç¨/h)</label>
<input type="number" id="calc_wage" value="30">
</div>
</div>

<button class="btn-calc" onclick="calculate(false)">Nur Preis berechnen</button>
<button class="btn-order" onclick="calculate(true)">Auftrag best√§tigen & Abbuchen</button>
<div id="order-success" class="success-msg">‚úÖ Lager erfolgreich aktualisiert!</div>
</div>

<div id="res" class="total-box" style="display:none;">
<span style="color: #888; font-size: 12px;">ANGEBOTSPREIS:</span>
<span id="total_price" class="price-tag">0,00 ‚Ç¨</span>
</div>
</div>

<script>
let inventory = JSON.parse(localStorage.getItem('d3d_inv')) || [];

function updateUI() {
const list = document.getElementById('inventory-list');
const select = document.getElementById('calc_mat_select');
list.innerHTML = '';
select.innerHTML = '';
let totalVal = 0;

inventory.forEach((item, index) => {
const isLow = item.stock < 150;
const div = document.createElement('div');
div.className = 'inventory-item' + (isLow ? ' low-stock' : '');
div.innerHTML = `
<span>
<strong class="${isLow ? 'low-stock-text' : ''}">${item.name}</strong>
${isLow ? '<span class="low-stock-text">‚ö†Ô∏è!</span>' : ''}<br>
${item.stock}g (${item.price}‚Ç¨/kg)
</span>
<button class="delete-btn" onclick="deleteItem(${index})">X</button>
`;
list.appendChild(div);

const opt = document.createElement('option');
opt.value = index;
opt.innerText = item.name + (isLow ? " (Niedrig!)" : "");
select.appendChild(opt);

totalVal += (item.stock / 1000) * item.price;
});

document.getElementById('warehouse-value').innerText = `Warenwert Lager: ${totalVal.toFixed(2)} ‚Ç¨`;
localStorage.setItem('d3d_inv', JSON.stringify(inventory));
}

function addMaterial() {
const name = document.getElementById('new_name').value;
const price = parseFloat(document.getElementById('new_price').value);
const stock = parseFloat(document.getElementById('new_stock').value);

if(name && !isNaN(price) && !isNaN(stock)) {
inventory.push({name, price, stock});
document.getElementById('new_name').value = '';
document.getElementById('new_price').value = '';
document.getElementById('new_stock').value = '';
updateUI();
}
}

function deleteItem(index) {
if(confirm("L√∂schen?")) {
inventory.splice(index, 1);
updateUI();
}
}

function calculate(doDeduct) {
const idx = document.getElementById('calc_mat_select').value;
if(idx === "") return alert("Material w√§hlen!");

const mat = inventory[idx];
const useG = parseFloat(document.getElementById('calc_g').value) || 0;
const h = parseFloat(document.getElementById('calc_h').value) || 0;
const min = parseFloat(document.getElementById('calc_min').value) || 0;
const wage = parseFloat(document.getElementById('calc_wage').value) || 30;

let matCosts = (useG / 1000) * mat.price;
let energy = h * 0.15 * 0.40;
let wear = h * 0.60;
let labor = (min / 60) * wage;
let total = (matCosts + energy + wear + labor) * 1.15;

document.getElementById('total_price').innerText = total.toLocaleString('de-DE', {style:'currency', currency:'EUR'});
document.getElementById('res').style.display = 'block';

if(doDeduct) {
inventory[idx].stock = Math.max(0, inventory[idx].stock - useG);
updateUI();
const msg = document.getElementById('order-success');
msg.style.display = 'block';
setTimeout(() => { msg.style.display = 'none'; }, 3000);
}
}

window.onload = updateUI;
</script>
</body>
</html>


